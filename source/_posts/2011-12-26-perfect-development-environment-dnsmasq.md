---
layout: post
title: DNSMasq
description: "getting local TLDs to work for us!"
tags: [series, tutorials, tools, automation]
category: code
published: false
kind: article
created_at: 2011-12-26 12:46:31 +05:30
series:
  id: PDE312
  number: 6
---
Hmm.. Why DNSMasq? Because, I prefer to have wildcard domains for my Local Domains. I want to simply say that, alright I want to have any hostname that ends with ".dev" mapped to my local server. With a little magic of <code>VirtualDocumentRoot</code>, I can even map all these wildcard domains to wildcard subdirectories in a particular directory at my local server. That is to say, I do not want to end up with a messy and massive <code>/etc/hosts</code> file, and want to have wildcard domains on my local server.

{% codeblock lang:bash %}sudo apt-get install dnsmasq
echo -e "\nlisten-address=127.0.0.1\n" | sudo tee -a /etc/dnsmasq.conf
echo "address=/.localhost/127.0.0.1" | sudo tee -a /etc/dnsmasq.d/localhost
echo -e "\ndomain localhost\n\nnameserver 127.0.0.1\n" | sudo tee -a /etc/resolv.conf
sudo service dnsmasq restart{% endcodeblock %}

Remember to only give the above commands once, since the last two commands append a line to some files, and you do not want them repeated. The above commands will allow you to randomly redirect <code>&lt;anything&gt;.localhost</code> to <code>127.0.0.1</code>. You can test this using the command below:
{% endcodeblock %}
You should receive a response like this:
{% codeblock lang:text %}PING something.localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_req=1 ttl=64 time=0.021 ms
64 bytes from localhost (127.0.0.1): icmp_req=2 ttl=64 time=0.031 ms
64 bytes from localhost (127.0.0.1): icmp_req=3 ttl=64 time=0.033 ms
64 bytes from localhost (127.0.0.1): icmp_req=4 ttl=64 time=0.036 ms
^C
--- something.localhost ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 2997ms
rtt min/avg/max/mdev = 0.021/0.030/0.036/0.006 ms{% endcodeblock %}

We will later add a task which will automate creation of these wildcard domains in DNSMasq, and setup an apache directory, etc. for instantly making a local site like: <code>something.dev</code> up and running.. :)

One problem that often occurs with the above setup is that, when you reboot your system, NetworkManager in Ubuntu will overwrite the <code>/etc/resolv.conf</code> file, which in turn will make your wildcard domains disappear in thin air. To resolve this issue, either search for something like "ubuntu resolv.conf file being overwritten" on Google (so that you can optimally apply a fix to suit your connection needs) or if you are not using DHCP, type the following command once you have modified the <code>/etc/resolv.conf</code> file to your liking:
{% endcodeblock %}
The above command will set the immutable bit on that file, and will prevent it from being overwritten in future.

To help you a little more, my current <code>/etc/resolv.conf</code> file looks like below:
{% codeblock lang:text %}nameserver 127.0.0.1
domain localhost

# Generated by NetworkManager
nameserver 8.8.8.8
nameserver 8.8.4.4{% endcodeblock %}
Notice that the last two nameservers are <a href="http://code.google.com/speed/public-dns/" target="_blank">Google's Public Nameservers</a>.
