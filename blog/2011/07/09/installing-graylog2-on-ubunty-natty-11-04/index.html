
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Install Graylog2 on Ubuntu 11.04 - Nikhil Gupta</title>
	<meta name="author" content="Nikhil Gupta">

	
	<meta name="description" content="amazing piece of software with breath-taking installation procedures">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Nikhil Gupta" type="application/atom+xml">
	
	<link rel="canonical" href="http://nikhgupta.com/blog/2011/07/09/installing-graylog2-on-ubunty-natty-11-04/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Alegreya|Mouse+Memoirs' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-21306915-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("me@nikhgupta.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>
<hgroup>
  <h1><a href="/">Nikhil Gupta</a></h1>
  
    <h2>God is divine. And, so is code.</h2>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:me@nikhgupta.com" title="Email">Email</a>
		
		
		
		
			<a class="twitter" href="http://twitter.com/nikhgupta" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/nikhgupta" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Install Graylog2 on Ubuntu 11.04</h1>
	<div class="entry-content" itemprop="articleBody"><p>Alright, so I wanted to install a <a href="http://graylog2.org">Graylog2</a> server on my
Ubuntu Natty for managing various system logs, custom tasks output, and
specially capturing <a href="http://rubyonrails.org">Rails</a> exceptions.  Configuring
a Graylog2 instance to run on Ubuntu was bit of a daunting task, but I,
finally, have it &ndash; installed, running and logging :) And, I must say, this is
a beauty &ndash; the dashboard, the filters, analytics and what not &ndash; in a very
clean, elegant Rails UI &ndash; heavily pink in color ;)</p>

<p>We need Java since Graylog2 server utilizes the awesome performce of it. We
need MongoDB for thats the database our logs would be saved into. And,
o&#8217;course, we need Ruby to run our web interface.</p>

<!-- more -->


<h3>Installing Java &amp; MongoDB</h3>

<p>Java and MongoDB are both available via APT/Synaptic.</p>

<pre><code>#!bash
sudo apt-get update
sudo apt-get install openjdk-6-jre mongodb
</code></pre>

<h3>Installing Graylog2 Server</h3>

<p>The commands below will download the graylog2 server, unzip it and copy the
configuration file, as needed. Finally, it will run MongoDB shell.</p>

<pre><code>#!bash
cd $HOME
mkdir -p $HOME/.graylog2
cd $HOME/.graylog2
wget https://github.com/downloads/Graylog2/graylog2-server/graylog2-server-0.9.5p1.tar.gz
tar xzf graylog2-server-0.9.5p1.tar.gz
sudo cp $HOME/.graylog2/graylog2-server/graylog2.conf.example /etc/graylog2.conf
mongo
</code></pre>

<p>Once we have the shell, type the following commands to configure a database to
be used by Graylog2 Server.</p>

<pre><code>#!bash
use graylog2
db.addUser("graylog2", "password")
exit
</code></pre>

<p>Now, open your favorite editor and edit the <code>etc/graylog2.conf</code> file with root
access. Change the configuration in there to match the MongoDB, you just
created. Typically, it would be:</p>

<pre><code>#!ini
mongodb_useauth = true
mongodb_user = graylog2
mongodb_password = password
mongodb_host = 127.0.0.1
# mongodb_replica_set = localhost:27017,localhost:27018,localhost:27019
mongodb_database = graylog2
mongodb_port = 27017
</code></pre>

<p>Once, everything above is configured, we can start our graylog2 server, using:</p>

<pre><code>#!bash
sudo java -jar /home//.graylog2/graylog2-server/graylog2-server.jar
</code></pre>

<p>Hopefully, if you received no error, we can proceed with installing Graylog2 Web Interface.</p>

<h3>Installing Ruby</h3>

<p>Ruby can be installed in many ways. However, I prefer installing Ruby via RVM
and utilizing 1.8.7-p334 branch with Graylog2.  I leave the task of installing
Ruby to the reader.</p>

<h3>Installing Graylog2 Web Interface</h3>

<p>Lets, download the Graylog2 web interface, and run <code>bundle install</code> so as to
install all the gems needed.</p>

<pre><code>#!bash
cd $HOME/.graylog2
wget https://github.com/downloads/Graylog2/graylog2-web-interface/graylog2-web-interface-0.9.5p2.tar.gz
tar xzf graylog2-web-interface-0.9.5p2.tar.gz
cd graylog2-web-interface-0.9.5p2
(rvm use 1.8.7@graylog2)
(rvmsudo) gem install bundler
(rvmsudo) bundle install
</code></pre>

<p>Finally, add the MongoDB configuration to the Web interface (edit
<code>config/mongoid.yml</code>)</p>

<pre><code>#!yaml
production:
host: localhost
port: 27017
Username: graylog2
Password: password
database: graylog2
</code></pre>

<p>Now, you can run the web interface with Rails command:</p>

<pre><code>#!bash
rails server -e production
</code></pre>

<p>You should now be able to run: <code>http://localhost:3000</code> and see your Graylog2 Web Interface.</p>

<h3>Automating (always-running) Graylog2 instance</h3>

<p>You may, optionally, want to keep the Graylog2 interface always running, while
the above commands will need you to run an instance of graylog2 server and web
interface everytime. Therefore, you can follow the steps below to configure
the Graylog2 instance as always-on.</p>

<h3>Use <a href="http://www.modrails.com/">Passenger</a></h3>

<p>To avoid starting the web interface everytime, you can use Passenger gem by
ModRails. Configuring the passenger server is covered in a lot more details in
the documentations and hence, I am not covering that specific part.</p>

<h3>Use StartUp scripts</h3>

<p>With Ubuntu, you can use startup scripts to run some particular scripts when
the system is started, saving you from running those <code>sudo service .. start</code>
commands after logging in, etc.</p>

<h3>Graylog2 StartUp Script</h3>

<p>Create a file: <code>/etc/init.d/graylog2-server</code> and copy the contents below, in
it.</p>

<pre><code>#!bash
#!/bin/sh
#
# graylog2-server: graylog2 message collector
#
# chkconfig: - 98 02
# description: This daemon listens for syslog and GELF messages and stores them in mongodb
#

CMD=$1
NOHUP=`which nohup`
JAVA_HOME=/usr/java/latest
JAVA_CMD=$JAVA_HOME/bin/java

GRAYLOG2_SERVER_HOME=/opt/graylog2-server

start() {
  echo "Starting graylog2-server ..."
  $NOHUP $JAVA_CMD -jar $GRAYLOG2_SERVER_HOME/graylog2-server.jar &gt; /var/log/graylog2.log 2&gt;&amp;1 &amp;
}

stop() {
  PID=`cat /tmp/graylog2.pid`
  echo "Stopping graylog2-server ($PID) ..."
  kill $PID
}

restart() {
  echo "Restarting graylog2-server ..."
  stop
  start
}

case "$CMD" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  restart)
    restart
    ;;
  *)
  echo "Usage $0 {start|stop|restart}"
  RETVAL=1
esac
</code></pre>

<p>Now, register the Graylog2-server Init script with startup, and run an instance:</p>

<pre><code>#!bash
sudo update-rc.d graylog2-server defaults
sudo service graylog2-server start
</code></pre>

<p><strong>This should get you up and running with a Graylog2 instance. Happy,
loggin!</strong></p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Nikhil Gupta -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			

<script type="text/javascript">
      var disqus_shortname = 'nikhgupta';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





		</div>
	</div>
</body>
</html>
